<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Généalogie Timeline 2D</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #f4f4f9; }
        .person-bar { fill: #4a90e2; rx: 4; ry: 4; cursor: pointer; transition: fill 0.2s; }
        .person-bar:hover { fill: #357abd; }
        .label { font-size: 12px; fill: white; pointer-events: none; }
        .axis-label { font-size: 14px; }
        #tooltip {
            position: absolute; visibility: hidden;
            background: white; border: 1px solid #ccc;
            padding: 10px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h2>Ma Lignée Temporelle</h2>
    <div id="canvas"></div>
    <div id="tooltip"></div>

<script>
    // 1. Simulation de données issues d'un parser GEDCOM
    const data = [
        { id: "1", name: "Jean Dupont", birth: 1850, death: 1910, details: "Père de famille, Menuisier" },
        { id: "2", name: "Marie Durand", birth: 1855, death: 1925, details: "Mère de 5 enfants" },
        { id: "3", name: "Pierre Dupont", birth: 1880, death: 1950, details: "Fils de Jean et Marie" },
        { id: "4", name: "Julie Martin", birth: 1885, death: 1960, details: "Épouse de Pierre" },
        { id: "5", name: "Lucie Dupont", birth: 1910, death: 1995, details: "Petite-fille" },
        { id: "6", name: "Ancêtre Inconnu", birth: 1820, death: 1870, details: "Lien flou" }
    ];

    // 2. Configuration
    const margin = {top: 20, right: 30, bottom: 40, left: 40};
    const width = 800 - margin.left - margin.right;
    const barHeight = 30;
    const barPadding = 10;

    // 3. Calcul automatique des "pistes" (Y) pour éviter les collisions
    data.sort((a, b) => a.birth - b.birth);
    let tracks = [];
    data.forEach(p => {
        let trackIndex = tracks.findIndex(tEnd => tEnd < p.birth);
        if (trackIndex === -1) {
            trackIndex = tracks.length;
            tracks.push(p.death);
        } else {
            tracks[trackIndex] = p.death;
        }
        p.track = trackIndex;
    });

    const height = tracks.length * (barHeight + barPadding) + margin.top + margin.bottom;

    // 4. Création du SVG
    const svg = d3.select("#canvas").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    // 5. Échelles (Axes)
    const x = d3.scaleLinear()
        .domain([d3.min(data, d => d.birth) - 5, d3.max(data, d => d.death) + 5])
        .range([0, width]);

    svg.append("g")
        .attr("transform", `translate(0,${height - margin.bottom})`)
        .call(d3.axisBottom(x).format(d3.format("d")));

    // 6. Dessin des barres
    const bars = svg.selectAll(".person")
        .data(data)
        .enter().append("g");

    bars.append("rect")
        .attr("class", "person-bar")
        .attr("x", d => x(d.birth))
        .attr("y", d => d.track * (barHeight + barPadding))
        .attr("width", d => x(d.death) - x(d.birth))
        .attr("height", barHeight)
        .on("mouseover", (event, d) => {
            d3.select("#tooltip")
                .style("visibility", "visible")
                .html(`<strong>${d.name}</strong><br>${d.birth} - ${d.death}<br><em>${d.details}</em>`);
        })
        .on("mousemove", (event) => {
            d3.select("#tooltip")
                .style("top", (event.pageY - 10) + "px")
                .style("left", (event.pageX + 10) + "px");
        })
        .on("mouseout", () => d3.select("#tooltip").style("visibility", "hidden"));

    // 7. Ajout du texte sur les barres
    bars.append("text")
        .attr("class", "label")
        .attr("x", d => x(d.birth) + 5)
        .attr("y", d => d.track * (barHeight + barPadding) + barHeight / 2 + 5)
        .text(d => d.name);

</script>
</body>
</html>